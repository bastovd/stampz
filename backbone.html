<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>LoveStamp</title>
	<link rel="stylesheet" type="text/css" href="jquery.sharer.css">
	<!--<link rel="stylesheet" type="text/css" href="backbone.css">-->
<style>
#main-container {
position : absolute;
min-width : 750px;
min-height :400px;
}

#sidebar {
	position : absolute;
	width : 20%;
	height : 100%;
	background : #eee;
	box-shadow : 2px 0px 5px 0px rgba(0,0,0,0.75);
	z-index : 100;
}

#topbar {
	position : absolute;
	width : 80%;
	height : 10%;
	background : #333;
	left : 20%;
}

#botbar {
	position : absolute;
	width : 80%;
	height : 15%;
	background : #333;
	left : 20%;
	bottom : 0;
}

#gallery {
	position : absolute;
	width : 80%;
	height : 75%;
	background : #fbfbfb;
	left : 20%;
	top : 10%;
	overflow-y : overlay;
	cursor : pointer;
}
#gallery::-webkit-scrollbar {
	width : 3px;
}
#gallery::-webkit-scrollbar * {
	display : none;
}
#gallery::-webkit-scrollbar-thumb {
	background : rgba(0,0,0,0.5);
	height : 20%;
}

#account {
	text-align : right;
	margin-right : 3%;
}
p {
	font-family : 'Tahoma';
}
#email-p {
	font-size : 9pt;
	color : #eee;
}
#store-p {
	font-size : 12pt;
	color : #eee;
}

#top-stripe {
	width : 100%;
	height : 10%;
	background : #333;
	position : absolute;
}
#store {
	width : 100%;
	height : 15%;
	bottom : 0;
	background : #333;
	position : absolute;
}
#store-button {
	width : 100%;
	height : 100%;
	text-align : center;
}

#result-buttons {
	position : absolute;
	width : 45%;
	height : 100%;
	bottom: 0;
	right : 0;
	text-align : right;
}
.result-button {
	width : 30%;
	height : 60%;
	background : #eee;
	border : none;
	margin-top : 4.5%;
	margin-right : 4%;
}
.result-button p {
	color : #333;
	font-size : 10pt;
}

/*share buttons*/
a {
	cursor: pointer;
}
#sharer-container {
	margin:1.5%;
}
#sharer-container .sharer-icon {
	margin-right: 1.5%;
}
/*-----------------*/

/*gallery example css*/
#thumbnails img {
    width : 15%;
	padding : 2.5%;
	margin : 0;
}

#thumbnails .active-stamp {
	background : #eee;
}

#large {
	position : absolute;
	margin-top : 0%;
	width : 100%;
	height : 90%;
}
#large img{
	position : absolute;
    width : 80%;
	margin : 10%;
}
</style>
</head>

<body>
	<div id="main-container">
		<div id="sidebar">
			<div id="top-stripe"></div>
			<div id="large"></div>
			<img src="envelope.png" style="width:100%;margin-top:125%;position:absolute" />
			<div id="store">
				<div id="store-button">
					<p id="store-p">BUY STAMPS</p>
				</div>
			</div>
		</div>
		<div id="topbar">
			<div id="account">
				<p id="email-p">dbastov@gmail.com</p>
			</div>
		</div>
		<div id="gallery">
			<div id="thumbnails" style="height:100%"></div>
		</div>
		<div id="botbar">
			<div id="sharer-container"></div>
			<div id="result-buttons">
				<button id="ok" class="result-button"><p>OK</p></button>
				<button id="cancel" class="result-button"><p>Cancel</p></button>
			</div>
		</div>
	</div>
	<!--scripts-->
	<script type="text/javascript">
		//external resources//
		/*var SERVER_ADDRESS = "https://rawgit.com/bastovd/stampz/master/";
		
		var backbone_css = '';
		var backbone_js = '';
		var jquery_sharer_js = '';
		var jquery_sharer_css = '';
		
		$.ajax({
			type: 'GET',
			url: SERVER_ADDRESS+'backbone.css',
			success: function (file) { // success
				backbone_css += file;
				$('head').append('<style>'+backbone_css+'</style>');
			}
		});
		$.ajax({
			type: 'GET',
			url: SERVER_ADDRESS+'backbone-examples.js',
			success: function (file) { // success
				backbone_js += file;
			}
		});*/
		
		
		/*var client = new XMLHttpRequest();
		client.open('GET', 'backbone.css');
		client.onreadystatechange = function() {
			backbone_css = client.responseText;
		}
		client.send();*/
	</script>
	<script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
	<script src="http://documentcloud.github.com/backbone/backbone-min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="jquery.sharer.js"></script>
	<script type="text/javascript">$("#sharer-container").sharer()</script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script> <!--parse-->
	<script src="backbone-examples.js"></script>
<!--<script type="text/javascript">
//Parse part///
Parse.initialize("UCluWeoSSy7eC1x7Euor51j3xzOSrUmK1F6HHcg0", "IyoWGfCQqgbaPB5Jb82ovvZe1nCzOXFSEttHZATt");

var ParseStamp = Parse.Object.extend("Stamp");
//stamps array
var stamps_names = ["orange", "kiwi", "watermelon", "dragonfruit", "strawberry", "pineapple", "pomegranate"];
var stamps_count = 7;

//pupulating the parse database with collections
var ParseCollection = Parse.Object.extend("Collection");
var parseCollection = new ParseCollection();
/*parseCollection.save({
collectionid: 0,
name: "fruit-cuts",
count: 7
},
{
success: function(object) {
	$(".success").show();
  },
  error: function(model, error) {
	$(".error").show();
  }
});*/
/////////////////////////////////

//populating the parse database with stamps
/*for (var i = 0; i < stamps_count; i++) {
	var parseStamp = new ParseStamp();
	parseStamp.save({
		stampid: i,
		name: stamps_names[i],
		collection: "fruit-cuts",
		price: 0
	}, 
	{
	  success: function(object) {
		$(".success").show();
	  },
	  error: function(model, error) {
		$(".error").show();
	  }
	});
}*/
//-------end Parse part----------//


//Backbone part///

//query for all stamps
var stamps_from_query = [];
var stamps_query = new Parse.Query(ParseStamp);
//stamps_query.include("bla");
stamps_query.find({
  success: function(results) {
	transferQueryOut(results);
  },
  error: function(error) {
  }
});
///////////////////////////

//get query results and process
var transferQueryOut = function(results) {
	stamps_from_query = results;
	//console.log(JSON.stringify(stamps_from_query));
	for (var i = 0; i < stamps_from_query.length; i++) {
		var stamp = new Stamp({
			id: stamps_from_query[i].get("stampid"),
			collection: stamps_from_query[i].get("collection"),
			name: stamps_from_query[i].get("name"),
			price: stamps_from_query[i].get("price")
		});
		console.log(JSON.stringify(stamp));
	}
}

//backbone stamp class
var Stamp = Backbone.Model.extend({
	changePrice: function(newPrice) {
		this.set({
			price: newPrice
		});
	}
});

/*console.log(JSON.stringify(stamp1));
console.log(JSON.stringify(stamp2));
//stamp1.changePrice(1);
console.log(JSON.stringify(stamp1));*/

//location.reload(); //reload the page

//--------Gallery START----------------------//
$(function() {
    var Photo = Backbone.Model.extend({});
    
    var IterableCollecton = Backbone.Collection.extend({
        initialize: function() {
            this.index = 0;
        },
        
        goTo: function(index) {
            if(index == this.index) return;
            if(index < 0) return;
            if(index >= this.length) return;
            
            this.index = index;
            this.trigger('goto');
        },
        
        current: function() {
            return this.at(this.index);
        }
        
        /*previous: function() {
            this.goTo(this.index - 1);
        },
        
        next: function() {
            this.goTo(this.index + 1);
        },
        
        isFirst: function() {
            return this.index == 0;
        },
        
        isLast: function() {
            return this.index == this.length - 1;
        }*/
    });
    
    var Photos = IterableCollecton.extend({
        model: Photo
    });
    
    var LargeView = Backbone.View.extend({
        el: '#large',
        
        initialize: function() {
            this.listenTo(this.collection, 'goto', this.change);
        },
        
        render: function() {
            var photo = this.collection.current();
            
            var img = $('<img>')
                .prop('src', photo.get('large'));
            
            this.$el.append(img);
            
            return this;
        },
        
        change: function() {
            this.$el.empty();
            this.render();
        }
    });
    
    var ThumbnailsView = Backbone.View.extend({
        el: '#thumbnails',
        
        events: {
            'click img': 'click'
        },
        
        initialize: function() {
            this.listenTo(this.collection, 'goto', this.change);
        },
        
        render: function() {
            var imgs = [];
            $.each(this.collection.models, function(index, photo) {
                var thumbnail = $('<img>')
                       .prop('src', photo.get('thumbnail'))
                       .data('index', index);
                imgs.push(thumbnail);
            });
            this.$el.append(imgs);
            
            this.change();
            
            return this;
        },
        
        click: function(event) {
            this.collection.goTo($(event.currentTarget).data('index'));
        },
        
        change: function() {
            var active_index = this.collection.index;
            
            this.$el.children().each(function(index) {
                var thumbnail = $(this);
                thumbnail.toggleClass(
                    'active-stamp', 
                    thumbnail.data('index') == active_index
                );
            });
        }
    });
    
    /*var IteratorButtonView = Backbone.View.extend({
        events: {
            'click': 'click'
        },
        
        initialize: function() {
            this.listenTo(this.collection, 'goto', this.render);
        },
        
        render: function() {
            this.$el.prop('disabled', this.isDisabled());
            return this;
        },
        
        isDisabled: function() {
            return false;
        }
    });
    
    var PreviousView = IteratorButtonView.extend({
        el: '#previous',
        
        isDisabled: function() {
            return this.collection.isFirst();
        },
        
        click: function() {
            this.collection.previous();
        }
    });

    var NextView = IteratorButtonView.extend({
        el: '#next',
        
        isDisabled: function() {
            return this.collection.isLast();
        },
        
        click: function() {
            this.collection.next();
        }
    });*/
    
    var AppView = Backbone.View.extend({
        el: '#gallery',
        
        initialize: function() {
            this.photos = new Photos();
            this.photos.add([
                { thumbnail: '0-thumbnail.png', large: '0-thumbnail.png' },
                { thumbnail: '1-thumbnail.png', large: '1-thumbnail.png' },
                { thumbnail: '2-thumbnail.png', large: '2-thumbnail.png' },
				{ thumbnail: '3-thumbnail.png', large: '3-thumbnail.png' },
				{ thumbnail: '0-thumbnail.png', large: '0-thumbnail.png' },
				{ thumbnail: '1-thumbnail.png', large: '1-thumbnail.png' },
				{ thumbnail: '2-thumbnail.png', large: '2-thumbnail.png' },
				{ thumbnail: '3-thumbnail.png', large: '3-thumbnail.png' },
				{ thumbnail: '0-thumbnail.png', large: '0-thumbnail.png' },
				{ thumbnail: '1-thumbnail.png', large: '1-thumbnail.png' },
				{ thumbnail: '2-thumbnail.png', large: '2-thumbnail.png' },
				{ thumbnail: '3-thumbnail.png', large: '3-thumbnail.png' }
            ]);
            
            this.large = new LargeView({
                collection: this.photos
            });
            
            this.thumbnails = new ThumbnailsView({
                collection: this.photos
            });
            
            /*this.previous = new PreviousView({
                collection: this.photos
            });
            
            this.next = new NextView({
                collection: this.photos
            });*/
        },
  
        render: function() {
            this.thumbnails.render();
            this.large.render();
            //this.previous.render();
            //this.next.render();
        }
    });

    new AppView().render();
}); 
//--------Gallery END--------------------//

</script>-->
</body>

</html>